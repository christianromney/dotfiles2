"use strict";var V=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var o in t)V(e,o,{get:t[o],enumerable:!0})},me=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ie(t))!se.call(e,s)&&s!==o&&V(e,s,{get:()=>t[s],enumerable:!(n=ne(t,s))||n.enumerable});return e};var le=e=>me(V({},"__esModule",{value:!0}),e);var de={};ae(de,{default:()=>re});module.exports=le(de);var i=require("@raycast/api"),oe=require("react");var J=require("react");var c=require("@raycast/api"),v=require("child_process"),Y=require("crypto"),u=require("fs"),G=require("path");var E=e=>{let t=Math.floor(e/3600),o=String(Math.floor(e%3600/60)).padStart(2,"0"),n=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${o}:${n}`},j=e=>{let t=new Date(e),o=[t.getFullYear().toString(),t.getMonth().toString().padStart(2,"0"),t.getDate().toString().padStart(2,"0")],n=[t.getHours(),t.getMinutes(),t.getSeconds()].map(f=>f.toString().padStart(2,"0")),s=o.join("-"),p=n.join(":");return`${s} ${p}`},U=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var N=c.environment.supportPath+"/customTimers.json",O=(e=!1)=>{let t=(0,c.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let o="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,c.showHUD)(o):(0,c.showToast)({style:c.Toast.Style.Failure,title:o}),!1}return!0};async function I(e,t="Untitled",o="default"){let s=(c.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,u.writeFileSync)(s,t);let p=(0,c.getPreferenceValues)(),f=`${c.environment.assetsPath+"/"+(o==="default"?p.selectedSound:o)}`,h=[`sleep ${e}`];h.push(`if [ -f "${s}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let w=`afplay "${f}" --volume ${p.volumeSetting.replace(",",".")}`;if(p.selectedSound==="speak_timer_name"?h.push(`say "${t}"`):h.push(w),p.ringContinuously){let C=`${s}`.replace(".timer",".dismiss");(0,u.writeFileSync)(C,".dismiss file for Timers"),h.push(`while [ -f "${C}" ]; do ${w}; done`)}h.push(`rm "${s}"; else echo "Timer deleted"; fi`),(0,v.exec)(h.join(" && "),(C,b)=>{if(C){console.log(`error: ${C.message}`);return}if(b){console.log(`stderr: ${b}`);return}}),(0,c.popToRoot)(),await(0,c.showHUD)(`Timer "${t}" started for ${E(e)}! \u{1F389}`)}function q(e){let t=c.environment.supportPath+"/"+e,o=`if [ -f "${t}" ]; then rm "${t}"; else echo "Timer deleted"; fi`,n=t.replace(".timer",".dismiss"),s=`if [ -f "${n}" ]; then rm "${n}"; else echo "Timer deleted"; fi`;(0,v.execSync)(o),(0,v.execSync)(s)}function z(){let e=[];return(0,u.readdirSync)(c.environment.supportPath).forEach(o=>{if((0,G.extname)(o)==".timer"){let n={name:"",secondsSet:-99,timeLeft:-99,originalFile:o,timeEnds:new Date};n.name=(0,u.readFileSync)(c.environment.supportPath+"/"+o).toString();let s=o.split("---");n.secondsSet=Number(s[1].split(".")[0]);let p=s[0].replace(/__/g,":");n.timeLeft=Math.max(0,Math.round(n.secondsSet-U({d2:p}))),n.timeEnds=new Date(p),n.timeEnds.setSeconds(n.timeEnds.getSeconds()+n.secondsSet),e.push(n)}}),e.sort((o,n)=>o.timeLeft-n.timeLeft),e}function K(e,t){let o=c.environment.supportPath+"/"+e;(0,u.writeFileSync)(o,t)}function F(){(0,u.existsSync)(N)||(0,u.writeFileSync)(N,JSON.stringify({}))}function k(e){F();let t=JSON.parse((0,u.readFileSync)(N,"utf8"));t[(0,Y.randomUUID)()]=e,(0,u.writeFileSync)(N,JSON.stringify(t))}function Q(){return F(),JSON.parse((0,u.readFileSync)(N,"utf8"))}function X(e,t){F();let o=JSON.parse((0,u.readFileSync)(N,"utf8"));o[e].name=t,(0,u.writeFileSync)(N,JSON.stringify(o))}function Z(e){F();let t=JSON.parse((0,u.readFileSync)(N,"utf8"));delete t[e],(0,u.writeFileSync)(N,JSON.stringify(t))}function H(){let[e,t]=(0,J.useState)(void 0),[o,n]=(0,J.useState)({}),[s,p]=(0,J.useState)(e===void 0),f=()=>{F();let l=z();t(l);let y=Q();n(y),p(!1)};return{timers:e,customTimers:o,isLoading:s,refreshTimers:f,handleStartTimer:(l,y,B=!1)=>{O(B)&&(I(l,y),f())},handleStopTimer:l=>{t(e?.filter(y=>y.originalFile!==l.originalFile)),q(l.originalFile),f()},handleStartCT:(l,y=!1)=>{O(y)&&(I(l.timeInSeconds,l.name,l.selectedSound),f())},handleCreateCT:l=>{let y={name:l.name,timeInSeconds:l.secondsSet,selectedSound:"default"};k(y),f()},handleDeleteCT:l=>{Z(l),f()}}}var S=require("@raycast/api");var L=require("@raycast/api");var D=require("fs");var $=L.environment.supportPath+"/raycast-stopwatches.json",ce=()=>{(!(0,D.existsSync)($)||(0,D.readFileSync)($).toString()=="")&&(0,D.writeFileSync)($,"[]")};var ee=(e,t)=>{ce();let n=JSON.parse((0,D.readFileSync)($,"utf8")).map(s=>s.swID==e?{...s,name:t}:s);(0,D.writeFileSync)($,JSON.stringify(n))};var A=require("react/jsx-runtime");function M(e){let t=o=>{if(o===""||o===e.currentName)new S.Toast({style:S.Toast.Style.Failure,title:"No new name given!"}).show();else{switch((0,S.popToRoot)(),e.originalFile){case"customTimer":X(e.ctID?e.ctID:"-99",o);break;case"stopwatch":ee(e.ctID?e.ctID:"-99",o);break;default:K(e.originalFile,o);break}new S.Toast({style:S.Toast.Style.Success,title:`Renamed to ${o}!`}).show()}};return(0,A.jsx)(S.Form,{actions:(0,A.jsx)(S.ActionPanel,{children:(0,A.jsx)(S.Action.SubmitForm,{title:"Rename",onSubmit:o=>t(o.newName)})}),children:(0,A.jsx)(S.Form.TextField,{id:"newName",title:"New name",placeholder:e.currentName})})}var d=require("@raycast/api"),R=require("react");var P=require("@raycast/api"),te=[{title:"Alarm Clock",icon:P.Icon.Alarm,value:"alarmClock.wav"},{title:"Dismembered Woodpecker",icon:P.Icon.Bird,value:"dismemberedWoodpecker.wav"},{title:"Flute Riff",icon:P.Icon.Music,value:"fluteRiff.wav"},{title:"Level Up",icon:P.Icon.Trophy,value:"levelUp.wav"},{title:"Piano Chime",icon:P.Icon.Music,value:"pianoChime.wav"},{title:"Terminator",icon:P.Icon.BarCode,value:"terminator.wav"},{title:"Speak Timer Name",icon:P.Icon.Person,value:"speak_timer_name"}];var g=require("react/jsx-runtime");function _(e){let t=Object.values(e.arguments).some(r=>r!==""),[o,n]=(0,R.useState)(),[s,p]=(0,R.useState)(),[f,h]=(0,R.useState)(),w=(0,d.getPreferenceValues)(),C=r=>{if(F(),r.hours===""&&r.minutes===""&&r.seconds==="")new d.Toast({style:d.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(r.hours)))n("Hours must be a number!");else if(isNaN(Number(r.minutes)))p("Minutes must be a number!");else if(isNaN(Number(r.seconds)))h("Seconds must be a number!");else{if(!O())return;(0,d.closeMainWindow)();let T=r.name?r.name:"Untitled",W=3600*Number(r.hours)+60*Number(r.minutes)+Number(r.seconds);I(W,T,r.selectedSound),r.willBeSaved&&k({name:r.name,timeInSeconds:W,selectedSound:r.selectedSound})}},b=()=>{o&&o.length>0&&n(void 0)},a=()=>{s&&s.length>0&&p(void 0)},l=()=>{f&&f.length>0&&h(void 0)},x=[{id:"hours",title:"Hours",placeholder:"0",err:o,drop:b,validator:r=>{let T=r.target.value;isNaN(Number(T))?n("Hours must be a number!"):b()}},{id:"minutes",title:"Minutes",placeholder:"00",err:s,drop:a,validator:r=>{let T=r.target.value;isNaN(Number(T))?p("Minutes must be a number!"):a()}},{id:"seconds",title:"Seconds",placeholder:"00",err:f,drop:l,validator:r=>{let T=r.target.value;isNaN(Number(T))?h("Seconds must be a number!"):l()}}];return w.newTimerInputOrder!=="hhmmss"&&x.reverse(),(0,g.jsxs)(d.Form,{actions:(0,g.jsx)(d.ActionPanel,{children:(0,g.jsx)(d.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:r=>C(r)})}),children:[x.map((r,T)=>(0,g.jsx)(d.Form.TextField,{id:r.id,title:r.title,placeholder:r.placeholder,defaultValue:e.arguments[r.id],error:r.err,onChange:r.drop,onBlur:r.validator},T)),(0,g.jsxs)(d.Form.Dropdown,{id:"selectedSound",defaultValue:"default",title:"Sound",children:[(0,g.jsx)(d.Form.Dropdown.Item,{value:"default",title:"Default"}),te.map((r,T)=>(0,g.jsx)(d.Form.Dropdown.Item,{title:r.value===w.selectedSound?`${r.title} (currently selected)`:r.title,value:r.value,icon:r.icon},T))]}),(0,g.jsx)(d.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:t}),(0,g.jsx)(d.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}var m=require("react/jsx-runtime");function re(){let{timers:e,customTimers:t,isLoading:o,refreshTimers:n,handleStopTimer:s,handleStartCT:p,handleCreateCT:f,handleDeleteCT:h}=H(),{push:w}=(0,i.useNavigation)();(0,oe.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]);let C={tag:{value:"Running",color:i.Color.Yellow}},b={tag:{value:"Finished!",color:i.Color.Green}};return(0,m.jsxs)(i.List,{isLoading:o,children:[(0,m.jsxs)(i.List.Section,{title:e?.length!==0&&e!=null?"Currently Running":"No Timers Running",children:[e?.map(a=>(0,m.jsx)(i.List.Item,{icon:{source:i.Icon.Clock,tintColor:a.timeLeft===0?i.Color.Green:i.Color.Yellow},title:a.name,subtitle:E(a.timeLeft)+" left",accessories:[{text:E(a.secondsSet)+" originally"},{text:`${a.timeLeft===0?"Ended":"Ends"} at ${j(a.timeEnds)}`},a.timeLeft===0?b:C],actions:(0,m.jsxs)(i.ActionPanel,{children:[(0,m.jsx)(i.Action,{title:"Stop Timer",onAction:()=>s(a)}),(0,m.jsx)(i.Action,{title:"Rename Timer",onAction:()=>w((0,m.jsx)(M,{currentName:a.name,originalFile:a.originalFile,ctID:null}))}),(0,m.jsx)(i.Action,{title:"Save Timer as Preset",shortcut:{modifiers:["cmd","shift"],key:"enter"},onAction:()=>f(a)})]})},a.originalFile)),(0,m.jsx)(i.List.Item,{icon:i.Icon.Clock,title:"Create a new timer",subtitle:"Press Enter to start a timer",actions:(0,m.jsx)(i.ActionPanel,{children:(0,m.jsx)(i.Action,{title:"Start Timer",onAction:()=>w((0,m.jsx)(_,{arguments:{hours:"",minutes:"",seconds:""}}))})})},0)]}),(0,m.jsx)(i.List.Section,{title:"Custom Timers",children:Object.keys(t)?.sort((a,l)=>t[a].timeInSeconds-t[l].timeInSeconds).map(a=>(0,m.jsx)(i.List.Item,{icon:i.Icon.Clock,title:t[a].name,subtitle:E(t[a].timeInSeconds),actions:(0,m.jsxs)(i.ActionPanel,{children:[(0,m.jsx)(i.Action,{title:"Start Timer",onAction:()=>p(t[a])}),(0,m.jsx)(i.Action,{title:"Rename Timer",onAction:()=>w((0,m.jsx)(M,{currentName:t[a].name,originalFile:"customTimer",ctID:a}))}),(0,m.jsx)(i.Action,{title:"Delete Custom Timer",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>h(a)})]})},a))})]})}

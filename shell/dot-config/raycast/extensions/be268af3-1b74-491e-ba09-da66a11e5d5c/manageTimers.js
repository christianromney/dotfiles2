"use strict";var D=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0})},Z=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let m of K(t))!Q.call(e,m)&&m!==r&&D(e,m,{get:()=>t[m],enumerable:!(n=G(t,m))||n.enumerable});return e};var ee=e=>Z(D({},"__esModule",{value:!0}),e);var te={};X(te,{default:()=>z});module.exports=ee(te);var o=require("@raycast/api"),q=require("react");var W=require("@raycast/api"),I=require("react");var T=require("@raycast/api"),w=require("child_process"),k=require("crypto"),c=require("fs"),H=require("path");var F=e=>{let t=Math.floor(e/3600),r=String(Math.floor(e%3600/60)).padStart(2,"0"),n=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${r}:${n}`};var C=T.environment.supportPath+"/customTimers.json";async function $(e,t="Untitled"){let n=(T.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,c.writeFileSync)(n,t);let m=(0,T.getPreferenceValues)(),p=`${T.environment.assetsPath+"/"+m.selectedSound}`,l=`sleep ${e} && if [ -f "${n}" ]; then `;if(m.selectedSound==="speak_timer_name"?l+=`say "${t}"`:l+=`afplay "${p}"`,m.ringContinuously){let g=`${n}`.replace(".timer",".dismiss");(0,c.writeFileSync)(g,".dismiss file for Timers"),l+=` && while [ -f "${g}" ]; do afplay "${p}"; done`}l+=` && osascript -e 'display notification "'"Timer complete"'" with title "Ding!"' && rm "${n}"; else echo "Timer deleted"; fi`,(0,w.exec)(l,(g,h)=>{if(g){console.log(`error: ${g.message}`);return}if(h){console.log(`stderr: ${h}`);return}}),(0,T.popToRoot)(),await(0,T.showHUD)(`Timer "${t}" started for ${F(e)}! \u{1F389}`)}function J(e){let t=`if [ -f "${e}" ]; then rm "${e}"; else echo "Timer deleted"; fi`,r=e.replace(".timer",".dismiss"),n=`if [ -f "${r}" ]; then rm "${r}"; else echo "Timer deleted"; fi`;(0,w.execSync)(t),(0,w.execSync)(n)}function _(){let e=[];return(0,c.readdirSync)(T.environment.supportPath).forEach(r=>{if((0,H.extname)(r)==".timer"){let n={name:"",secondsSet:-99,timeLeft:-99,originalFile:r};n.name=(0,c.readFileSync)(T.environment.supportPath+"/"+r).toString();let m=r.split("---");n.secondsSet=Number(m[1].split(".")[0]);let p=m[0].replace(/__/g,":");n.timeLeft=Math.max(0,Math.round(n.secondsSet-(new Date().getTime()-new Date(p).getTime())/1e3)),e.push(n)}}),e.sort((r,n)=>r.timeLeft-n.timeLeft),e}function U(e,t){let r=T.environment.supportPath+"/"+e;(0,c.writeFileSync)(r,t)}function b(){(0,c.existsSync)(C)||(0,c.writeFileSync)(C,JSON.stringify({}))}function A(e){b();let t=JSON.parse((0,c.readFileSync)(C,"utf8"));t[(0,k.randomUUID)()]=e,(0,c.writeFileSync)(C,JSON.stringify(t))}function B(){return b(),JSON.parse((0,c.readFileSync)(C,"utf8"))}function j(e,t){b();let r=JSON.parse((0,c.readFileSync)(C,"utf8"));r[e].name=t,(0,c.writeFileSync)(C,JSON.stringify(r))}function Y(e){b();let t=JSON.parse((0,c.readFileSync)(C,"utf8"));delete t[e],(0,c.writeFileSync)(C,JSON.stringify(t))}function v(){let[e,t]=(0,I.useState)(void 0),[r,n]=(0,I.useState)({}),[m,p]=(0,I.useState)(e===void 0),l=()=>{b();let d=_();t(d);let N=B();n(N),p(!1)};return{timers:e,customTimers:r,isLoading:m,refreshTimers:l,handleStartTimer:(d,N)=>{$(d,N),l()},handleStopTimer:d=>{t(e?.filter(N=>N.originalFile!==d.originalFile)),J(`${W.environment.supportPath}/${d.originalFile}`),l()},handleStartCT:d=>{$(d.timeInSeconds,d.name),l()},handleCreateCT:d=>{let N={name:d.name,timeInSeconds:d.secondsSet};A(N),l()},handleDeleteCT:d=>{Y(d),l()}}}var f=require("@raycast/api");var E=require("react/jsx-runtime");function O(e){let t=r=>{r===""||r===e.currentName?new f.Toast({style:f.Toast.Style.Failure,title:"No new name given!"}).show():((0,f.popToRoot)(),e.originalFile=="customTimer"?j(e.ctID?e.ctID:"-99",r):U(e.originalFile,r),new f.Toast({style:f.Toast.Style.Success,title:`Renamed to ${r}!`}).show())};return(0,E.jsx)(f.Form,{actions:(0,E.jsx)(f.ActionPanel,{children:(0,E.jsx)(f.Action.SubmitForm,{title:"Rename",onSubmit:r=>t(r.newName)})}),children:(0,E.jsx)(f.Form.TextField,{id:"newName",title:"New name",placeholder:e.currentName})})}var u=require("@raycast/api"),x=require("react");var y=require("react/jsx-runtime");function L(e){let t=Object.values(e.arguments).some(i=>i!==""),[r,n]=(0,x.useState)(),[m,p]=(0,x.useState)(),[l,g]=(0,x.useState)(),h=i=>{if(b(),i.hours===""&&i.minutes===""&&i.seconds==="")new u.Toast({style:u.Toast.Style.Failure,title:"No values set for timer length!"}).show();else if(isNaN(Number(i.hours)))n("Hours must be a number!");else if(isNaN(Number(i.minutes)))p("Minutes must be a number!");else if(isNaN(Number(i.seconds)))g("Seconds must be a number!");else{(0,u.closeMainWindow)();let S=i.name?i.name:"Untitled",M=3600*Number(i.hours)+60*Number(i.minutes)+Number(i.seconds);$(M,S),i.willBeSaved&&A({name:i.name,timeInSeconds:M})}},s=()=>{r&&r.length>0&&n(void 0)},P=()=>{m&&m.length>0&&p(void 0)},R=()=>{l&&l.length>0&&g(void 0)},V=[{id:"hours",title:"Hours",placeholder:"0",err:r,drop:s,validator:i=>{let S=i.target.value;isNaN(Number(S))?n("Hours must be a number!"):s()}},{id:"minutes",title:"Minutes",placeholder:"00",err:m,drop:P,validator:i=>{let S=i.target.value;isNaN(Number(S))?p("Minutes must be a number!"):P()}},{id:"seconds",title:"Seconds",placeholder:"00",err:l,drop:R,validator:i=>{let S=i.target.value;isNaN(Number(S))?g("Seconds must be a number!"):R()}}];return(0,u.getPreferenceValues)().newTimerInputOrder!=="hhmmss"&&V.reverse(),(0,y.jsxs)(u.Form,{actions:(0,y.jsx)(u.ActionPanel,{children:(0,y.jsx)(u.Action.SubmitForm,{title:"Start Custom Timer",onSubmit:i=>h(i)})}),children:[V.map((i,S)=>(0,y.jsx)(u.Form.TextField,{id:i.id,title:i.title,placeholder:i.placeholder,defaultValue:e.arguments[i.id],error:i.err,onChange:i.drop,onBlur:i.validator},S)),(0,y.jsx)(u.Form.TextField,{id:"name",title:"Name",placeholder:"Pour Tea",autoFocus:t}),(0,y.jsx)(u.Form.Checkbox,{id:"willBeSaved",label:"Save as preset"})]})}var a=require("react/jsx-runtime");function z(){let{timers:e,customTimers:t,isLoading:r,refreshTimers:n,handleStopTimer:m,handleStartCT:p,handleCreateCT:l,handleDeleteCT:g}=v(),{push:h}=(0,o.useNavigation)();return(0,q.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]),(0,a.jsxs)(o.List,{isLoading:r,children:[(0,a.jsxs)(o.List.Section,{title:e?.length!==0&&e!=null?"Currently Running":"No Timers Running",children:[e?.map(s=>(0,a.jsx)(o.List.Item,{icon:{source:o.Icon.Clock,tintColor:o.Color.Yellow},title:s.name,subtitle:F(s.timeLeft)+" left",accessoryTitle:F(s.secondsSet)+" originally",actions:(0,a.jsxs)(o.ActionPanel,{children:[(0,a.jsx)(o.Action,{title:"Stop Timer",onAction:()=>m(s)}),(0,a.jsx)(o.Action,{title:"Rename Timer",onAction:()=>h((0,a.jsx)(O,{currentName:s.name,originalFile:s.originalFile,ctID:null}))}),(0,a.jsx)(o.Action,{title:"Save Timer as Preset",shortcut:{modifiers:["cmd","shift"],key:"enter"},onAction:()=>l(s)})]})},s.originalFile)),(0,a.jsx)(o.List.Item,{icon:o.Icon.Clock,title:"Create a new timer",subtitle:"Press Enter to start a timer",actions:(0,a.jsx)(o.ActionPanel,{children:(0,a.jsx)(o.Action,{title:"Start Timer",onAction:()=>h((0,a.jsx)(L,{arguments:{hours:"",minutes:"",seconds:""}}))})})},0)]}),(0,a.jsx)(o.List.Section,{title:"Custom Timers",children:Object.keys(t)?.sort((s,P)=>t[s].timeInSeconds-t[P].timeInSeconds).map(s=>(0,a.jsx)(o.List.Item,{icon:o.Icon.Clock,title:t[s].name,subtitle:F(t[s].timeInSeconds),actions:(0,a.jsxs)(o.ActionPanel,{children:[(0,a.jsx)(o.Action,{title:"Start Timer",onAction:()=>p(t[s])}),(0,a.jsx)(o.Action,{title:"Rename Timer",onAction:()=>h((0,a.jsx)(O,{currentName:t[s].name,originalFile:"customTimer",ctID:s}))}),(0,a.jsx)(o.Action,{title:"Delete Custom Timer",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>g(s)})]})},s))})]})}0&&(module.exports={});

"use strict";var $=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var U=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},j=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of b(t))!_.call(e,i)&&i!==n&&$(e,i,{get:()=>t[i],enumerable:!(r=J(t,i))||r.enumerable});return e};var H=e=>j($({},"__esModule",{value:!0}),e);var R={};U(R,{default:()=>B});module.exports=H(R);var o=require("@raycast/api"),v=require("react");var y=require("react");var s=require("@raycast/api"),M=require("child_process"),k=require("crypto"),c=require("fs"),A=require("path");var S=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),r=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${n}:${r}`};var P=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var p=s.environment.supportPath+"/customTimers.json",w=(e=!1)=>{let t=(0,s.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let n="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,s.showHUD)(n):(0,s.showToast)({style:s.Toast.Style.Failure,title:n}),!1}return!0};async function D(e,t="Untitled",n="default"){let i=(s.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,c.writeFileSync)(i,t);let l=(0,s.getPreferenceValues)(),f=`${s.environment.assetsPath+"/"+(n==="default"?l.selectedSound:n)}`,d=[`sleep ${e}`];d.push(`if [ -f "${i}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let h=`afplay "${f}" --volume ${l.volumeSetting.replace(",",".")}`;if(l.selectedSound==="speak_timer_name"?d.push(`say "${t}"`):d.push(h),l.ringContinuously){let a=`${i}`.replace(".timer",".dismiss");(0,c.writeFileSync)(a,".dismiss file for Timers"),d.push(`while [ -f "${a}" ]; do ${h}; done`)}d.push(`rm "${i}"; else echo "Timer deleted"; fi`),(0,M.exec)(d.join(" && "),(a,g)=>{if(a){console.log(`error: ${a.message}`);return}if(g){console.log(`stderr: ${g}`);return}}),(0,s.popToRoot)(),await(0,s.showHUD)(`Timer "${t}" started for ${S(e)}! \u{1F389}`)}function x(e){let t=s.environment.supportPath+"/"+e,n=`if [ -f "${t}" ]; then rm "${t}"; else echo "Timer deleted"; fi`,r=t.replace(".timer",".dismiss"),i=`if [ -f "${r}" ]; then rm "${r}"; else echo "Timer deleted"; fi`;(0,M.execSync)(n),(0,M.execSync)(i)}function F(){let e=[];return(0,c.readdirSync)(s.environment.supportPath).forEach(n=>{if((0,A.extname)(n)==".timer"){let r={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};r.name=(0,c.readFileSync)(s.environment.supportPath+"/"+n).toString();let i=n.split("---");r.secondsSet=Number(i[1].split(".")[0]);let l=i[0].replace(/__/g,":");r.timeLeft=Math.max(0,Math.round(r.secondsSet-P({d2:l}))),r.timeEnds=new Date(l),r.timeEnds.setSeconds(r.timeEnds.getSeconds()+r.secondsSet),e.push(r)}}),e.sort((n,r)=>n.timeLeft-r.timeLeft),e}function C(){(0,c.existsSync)(p)||(0,c.writeFileSync)(p,JSON.stringify({}))}function O(e){C();let t=JSON.parse((0,c.readFileSync)(p,"utf8"));t[(0,k.randomUUID)()]=e,(0,c.writeFileSync)(p,JSON.stringify(t))}function L(){return C(),JSON.parse((0,c.readFileSync)(p,"utf8"))}function E(e){C();let t=JSON.parse((0,c.readFileSync)(p,"utf8"));delete t[e],(0,c.writeFileSync)(p,JSON.stringify(t))}function I(){let[e,t]=(0,y.useState)(void 0),[n,r]=(0,y.useState)({}),[i,l]=(0,y.useState)(e===void 0),f=()=>{C();let u=F();t(u);let T=L();r(T),l(!1)};return{timers:e,customTimers:n,isLoading:i,refreshTimers:f,handleStartTimer:(u,T,N=!1)=>{w(N)&&(D(u,T),f())},handleStopTimer:u=>{t(e?.filter(T=>T.originalFile!==u.originalFile)),x(u.originalFile),f()},handleStartCT:(u,T=!1)=>{w(T)&&(D(u.timeInSeconds,u.name,u.selectedSound),f())},handleCreateCT:u=>{let T={name:u.name,timeInSeconds:u.secondsSet,selectedSound:"default"};O(T),f()},handleDeleteCT:u=>{E(u),f()}}}var m=require("react/jsx-runtime");function B(){let{timers:e,customTimers:t,isLoading:n,refreshTimers:r,handleStartTimer:i,handleStopTimer:l,handleStartCT:f}=I();(0,v.useEffect)(()=>{r(),setInterval(()=>{r()},1e3)},[]),n&&r();let d=(0,o.getPreferenceValues)();if((e==null||e.length==0||e.length==null)&&d.showMenuBarItemWhen!=="always")return null;let h=()=>{if(!(e===void 0||e?.length===0||e.length==null))return d.showTitleInMenuBar?`${e[0].name}: ~${S(e[0].timeLeft)}`:`~${S(e[0].timeLeft)}`};return(0,m.jsxs)(o.MenuBarExtra,{icon:d.showMenuBarItemWhen!=="never"?o.Icon.Clock:void 0,isLoading:n,title:h(),children:[(0,m.jsx)(o.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(a=>(0,m.jsx)(o.MenuBarExtra.Item,{title:a.name+": "+S(a.timeLeft)+" left",onAction:()=>l(a)},a.originalFile)),(0,m.jsx)(o.MenuBarExtra.Section,{children:Object.keys(t)?.sort((a,g)=>t[a].timeInSeconds-t[g].timeInSeconds).map(a=>(0,m.jsx)(o.MenuBarExtra.Item,{title:'Start "'+t[a].name+'"',onAction:()=>f(t[a],!0)},a))}),(0,m.jsxs)(o.MenuBarExtra.Section,{children:[(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 2 Minute Timer",onAction:()=>i(60*2,"2 Minute Timer",!0)},"2M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 5 Minute Timer",onAction:()=>i(60*5,"5 Minute Timer",!0)},"5M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 10 Minute Timer",onAction:()=>i(60*10,"10 Minute Timer",!0)},"10M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 15 Minute Timer",onAction:()=>i(60*15,"15 Minute Timer",!0)},"15M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 30 Minute Timer",onAction:()=>i(60*30,"30 Minute Timer",!0)},"30M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 45 Minute Timer",onAction:()=>i(60*45,"45 Minute Timer",!0)},"45M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 60 Minute Timer",onAction:()=>i(60*60,"60 Minute Timer",!0)},"60M"),(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start 90 Minute Timer",onAction:()=>i(60*60*1.5,"90 Minute Timer",!0)},"90M")]}),(0,m.jsx)(o.MenuBarExtra.Section,{title:"Custom Timer",children:(0,m.jsx)(o.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,o.launchCommand)({name:"startCustomTimer",type:o.LaunchType.UserInitiated})},"custom")})]})}

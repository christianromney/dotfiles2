"use strict";var I=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var n in t)I(e,n,{get:t[n],enumerable:!0})},Z=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of K(t))!Q.call(e,s)&&s!==n&&I(e,s,{get:()=>t[s],enumerable:!(r=G(t,s))||r.enumerable});return e};var ee=e=>Z(I({},"__esModule",{value:!0}),e);var te={};X(te,{default:()=>q});module.exports=ee(te);var u=require("@raycast/api"),Y=require("react");var w=require("react");var a=require("@raycast/api"),P=require("child_process"),k=require("crypto"),i=require("fs"),x=require("path");var h=e=>{let t=Math.floor(e/3600),n=String(Math.floor(e%3600/60)).padStart(2,"0"),r=String(Math.floor(e%60)).padStart(2,"0");return`${t===0?"":t+":"}${n}:${r}`};var L=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var p=a.environment.supportPath+"/customTimers.json",b=a.environment.supportPath+"/defaultPresetVisibles.json",$=(e=!1)=>{let t=(0,a.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let n="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,a.showHUD)(n):(0,a.showToast)({style:a.Toast.Style.Failure,title:n}),!1}return!0};async function O(e,t="Untitled",n="default"){(0,a.popToRoot)();let s=(a.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,i.writeFileSync)(s,t);let l=(0,a.getPreferenceValues)(),c=`${a.environment.assetsPath+"/"+(n==="default"?l.selectedSound:n)}`,d=[`sleep ${e}`];d.push(`if [ -f "${s}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let M=`afplay "${c}" --volume ${l.volumeSetting.replace(",",".")}`;if(l.selectedSound==="speak_timer_name"?d.push(`say "${t}"`):d.push(M),l.ringContinuously){let g=`${s}`.replace(".timer",".dismiss");(0,i.writeFileSync)(g,".dismiss file for Timers"),d.push(`while [ -f "${g}" ]; do ${M}; done`)}d.push(`rm "${s}"; else echo "Timer deleted"; fi`),(0,P.exec)(d.join(" && "),(g,C)=>{if(g){console.log(`error: ${g.message}`);return}if(C){console.log(`stderr: ${C}`);return}}),await(0,a.showHUD)(`Timer "${t}" started for ${h(e)}! \u{1F389}`)}function A(e){let t=a.environment.supportPath+"/"+e,n=`if [ -f "${t}" ]; then rm "${t}"; else echo "Timer deleted"; fi`,r=t.replace(".timer",".dismiss"),s=`if [ -f "${r}" ]; then rm "${r}"; else echo "Timer deleted"; fi`;(0,P.execSync)(n),(0,P.execSync)(s)}function F(){let e=[];return(0,i.readdirSync)(a.environment.supportPath).forEach(n=>{if((0,x.extname)(n)==".timer"){let r={name:"",secondsSet:-99,timeLeft:-99,originalFile:n,timeEnds:new Date};r.name=(0,i.readFileSync)(a.environment.supportPath+"/"+n).toString();let s=n.split("---");r.secondsSet=Number(s[1].split(".")[0]);let l=s[0].replace(/__/g,":");r.timeLeft=Math.max(0,Math.round(r.secondsSet-L({d2:l}))),r.timeEnds=new Date(l),r.timeEnds.setSeconds(r.timeEnds.getSeconds()+r.secondsSet),e.push(r)}}),e.sort((n,r)=>n.timeLeft-r.timeLeft),e}function y(){(0,i.existsSync)(p)||(0,i.writeFileSync)(p,JSON.stringify({}))}function N(e){y();let t=JSON.parse((0,i.readFileSync)(p,"utf8"));t[(0,k.randomUUID)()]=e,(0,i.writeFileSync)(p,JSON.stringify(t))}function J(){y();let e=JSON.parse((0,i.readFileSync)(p,"utf8"));return Object.fromEntries(Object.entries(e).map(([t,n])=>n.showInMenuBar===void 0?[t,{...n,showInMenuBar:!0}]:[t,n]))}function v(e){y();let t=JSON.parse((0,i.readFileSync)(p,"utf8"));delete t[e],(0,i.writeFileSync)(p,JSON.stringify(t))}function R(e){y();let t=JSON.parse((0,i.readFileSync)(p,"utf8")),n=t[e].showInMenuBar;t[e].showInMenuBar=n===void 0?!1:!n,(0,i.writeFileSync)(p,JSON.stringify(t))}var _=()=>{if(!(0,i.existsSync)(b)){let t={"2M":!0,"5M":!0,"10M":!0,"15M":!0,"30M":!0,"45M":!0,"60M":!0,"90M":!0};return(0,i.writeFileSync)(b,JSON.stringify(t)),t}return JSON.parse((0,i.readFileSync)(b,"utf8"))},j=e=>{let t=JSON.parse((0,i.readFileSync)(b,"utf8"));t[e]=!t[e],(0,i.writeFileSync)(b,JSON.stringify(t))};var S=require("@raycast/api");function V(){let[e,t]=(0,w.useState)(void 0),[n,r]=(0,w.useState)({}),[s,l]=(0,w.useState)(e===void 0),c=()=>{y();let m=F();t(m);let f=J();r(f),l(!1)};return{timers:e,customTimers:n,isLoading:s,refreshTimers:c,handleStartTimer:(m,f,z=!1)=>{$(z)&&(O(m,f),c())},handleStopTimer:m=>{t(e?.filter(f=>f.originalFile!==m.originalFile)),A(m.originalFile),c()},handleStartCT:(m,f=!1)=>{$(f)&&(O(m.timeInSeconds,m.name,m.selectedSound),c())},handleCreateCT:m=>{let f={name:m.name,timeInSeconds:m.secondsSet,selectedSound:"default",showInMenuBar:!0};N(f),c()},handleDeleteCT:async m=>{let f={title:"Delete this preset?",icon:S.Icon.Trash,message:"You won't be able to recover it.",dismissAction:{title:"Cancel",style:S.Alert.ActionStyle.Cancel},primaryAction:{title:"Delete",style:S.Alert.ActionStyle.Destructive}};await(0,S.confirmAlert)(f)&&(v(m),c())},handleToggleCTVisibility:async m=>{R(m),c()}}}var U=(e,t)=>(e==null||e.length==0||e.length==null)&&!["always","onlyWhenNotRunning"].includes(t.showMenuBarIconWhen),W=(e,t)=>{if(e===void 0||e?.length===0||e.length==null)return;let n="timeLeft"in e[0]?e[0].timeLeft:e[0].timeElapsed;return t.showTitleInMenuBar?`${e[0].name}: ~${h(n)}`:`~${h(n)}`},H=(e,t,n)=>{switch(t.showMenuBarIconWhen){case"always":return n;case"never":return;case"onlyWhenRunning":return e!==void 0&&e?.length>0?n:void 0;case"onlyWhenNotRunning":return e===void 0||e?.length===0?n:void 0}};var B=require("react");function E(){let e=[{key:"2M",title:"2 Minute Timer",seconds:120},{key:"5M",title:"5 Minute Timer",seconds:300},{key:"10M",title:"10 Minute Timer",seconds:600},{key:"15M",title:"15 Minute Timer",seconds:900},{key:"30M",title:"30 Minute Timer",seconds:1800},{key:"45M",title:"45 Minute Timer",seconds:2700},{key:"60M",title:"60 Minute Timer",seconds:3600},{key:"90M",title:"90 Minute Timer",seconds:5400}],[t,n]=(0,B.useState)(),[r,s]=(0,B.useState)(t===void 0),l=()=>{n(_()),s(!1)};return{defaultPresets:e,defaultVisibles:t,isLoadingVisibles:r,refreshDefaultVisibles:l,handleDefaultPresetToggle:d=>{j(d),l()}}}var T=require("react/jsx-runtime");function q(){let{timers:e,customTimers:t,isLoading:n,refreshTimers:r,handleStartTimer:s,handleStopTimer:l,handleStartCT:c}=V(),{defaultPresets:d,defaultVisibles:M,refreshDefaultVisibles:g,isLoadingVisibles:C}=E();(0,Y.useEffect)(()=>{r(),g(),setInterval(()=>{r()},1e3)},[]),n&&r();let D=(0,u.getPreferenceValues)();return U(e,D)?null:(0,T.jsxs)(u.MenuBarExtra,{icon:H(e,D,u.Icon.Clock),isLoading:n&&C,title:W(e,D),children:[(0,T.jsx)(u.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(o=>(0,T.jsx)(u.MenuBarExtra.Item,{title:o.name+": "+h(o.timeLeft)+" left",onAction:()=>l(o)},o.originalFile)),(0,T.jsx)(u.MenuBarExtra.Section,{children:Object.keys(t)?.sort((o,m)=>t[o].timeInSeconds-t[m].timeInSeconds).filter(o=>t[o].showInMenuBar).map(o=>(0,T.jsx)(u.MenuBarExtra.Item,{title:'Start "'+t[o].name+'"',onAction:()=>c(t[o],!0)},o))}),(0,T.jsx)(u.MenuBarExtra.Section,{children:d.filter(o=>M?.[o.key]).map(o=>(0,T.jsx)(u.MenuBarExtra.Item,{title:`Start ${o.title}`,onAction:()=>s(o.seconds,o.title,!0)},o.key))}),(0,T.jsx)(u.MenuBarExtra.Section,{title:"Custom Timer",children:(0,T.jsx)(u.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,u.launchCommand)({name:"startCustomTimer",type:u.LaunchType.UserInitiated})},"custom")})]})}

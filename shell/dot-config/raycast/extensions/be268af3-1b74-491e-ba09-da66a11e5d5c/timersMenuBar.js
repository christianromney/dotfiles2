"use strict";var $=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var j=(e,t)=>{for(var r in t)$(e,r,{get:t[r],enumerable:!0})},H=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of B(t))!U.call(e,i)&&i!==r&&$(e,i,{get:()=>t[i],enumerable:!(o=_(t,i))||o.enumerable});return e};var R=e=>H($({},"__esModule",{value:!0}),e);var q={};j(q,{default:()=>b});module.exports=R(q);var n=require("@raycast/api"),J=require("react");var N=require("@raycast/api"),M=require("react");var m=require("@raycast/api"),g=require("child_process"),P=require("crypto"),c=require("fs"),w=require("path");var h=e=>{let t=Math.floor(e/3600),r=String(Math.floor(e%3600/60)).padStart(2,"0"),o=String(Math.floor(e%60)).padStart(2,"0");return`${t}:${r}:${o}`};var A=e=>(e.d1=e.d1=="----"?void 0:e.d1,e.d2=e.d2=="----"?void 0:e.d2,Math.round((e.d1?new Date(e.d1):new Date).getTime()-(e.d2?new Date(e.d2):new Date).getTime())/1e3);var T=m.environment.supportPath+"/customTimers.json",D=(e=!1)=>{let t=(0,m.getPreferenceValues)();if(parseFloat(t.volumeSetting)>5){let r="\u26A0\uFE0F Timer alert volume should not be louder than 5 (it can get quite loud!)";return e?(0,m.showHUD)(r):(0,m.showToast)({style:m.Toast.Style.Failure,title:r}),!1}return!0};async function I(e,t="Untitled",r="default"){let i=(m.environment.supportPath+"/"+new Date().toISOString()+"---"+e+".timer").replace(/:/g,"__");(0,c.writeFileSync)(i,t);let l=(0,m.getPreferenceValues)(),d=`${m.environment.assetsPath+"/"+(r==="default"?l.selectedSound:r)}`,s=[`sleep ${e}`];s.push(`if [ -f "${i}" ]; then osascript -e 'display notification "Timer \\"${t}\\" complete" with title "Ding!"'`);let S=`afplay "${d}" --volume ${l.volumeSetting.replace(",",".")}`;if(l.selectedSound==="speak_timer_name"?s.push(`say "${t}"`):s.push(S),l.ringContinuously){let p=`${i}`.replace(".timer",".dismiss");(0,c.writeFileSync)(p,".dismiss file for Timers"),s.push(`while [ -f "${p}" ]; do ${S}; done`)}s.push(`rm "${i}"; else echo "Timer deleted"; fi`),(0,g.exec)(s.join(" && "),(p,y)=>{if(p){console.log(`error: ${p.message}`);return}if(y){console.log(`stderr: ${y}`);return}}),(0,m.popToRoot)(),await(0,m.showHUD)(`Timer "${t}" started for ${h(e)}! \u{1F389}`)}function O(e){let t=`if [ -f "${e}" ]; then rm "${e}"; else echo "Timer deleted"; fi`,r=e.replace(".timer",".dismiss"),o=`if [ -f "${r}" ]; then rm "${r}"; else echo "Timer deleted"; fi`;(0,g.execSync)(t),(0,g.execSync)(o)}function x(){let e=[];return(0,c.readdirSync)(m.environment.supportPath).forEach(r=>{if((0,w.extname)(r)==".timer"){let o={name:"",secondsSet:-99,timeLeft:-99,originalFile:r};o.name=(0,c.readFileSync)(m.environment.supportPath+"/"+r).toString();let i=r.split("---");o.secondsSet=Number(i[1].split(".")[0]);let l=i[0].replace(/__/g,":");o.timeLeft=Math.max(0,Math.round(o.secondsSet-A({d2:l}))),e.push(o)}}),e.sort((r,o)=>r.timeLeft-o.timeLeft),e}function C(){(0,c.existsSync)(T)||(0,c.writeFileSync)(T,JSON.stringify({}))}function L(e){C();let t=JSON.parse((0,c.readFileSync)(T,"utf8"));t[(0,P.randomUUID)()]=e,(0,c.writeFileSync)(T,JSON.stringify(t))}function F(){return C(),JSON.parse((0,c.readFileSync)(T,"utf8"))}function v(e){C();let t=JSON.parse((0,c.readFileSync)(T,"utf8"));delete t[e],(0,c.writeFileSync)(T,JSON.stringify(t))}function k(){let[e,t]=(0,M.useState)(void 0),[r,o]=(0,M.useState)({}),[i,l]=(0,M.useState)(e===void 0),d=()=>{C();let u=x();t(u);let f=F();o(f),l(!1)};return{timers:e,customTimers:r,isLoading:i,refreshTimers:d,handleStartTimer:(u,f,E=!1)=>{!D(E)||(I(u,f),d())},handleStopTimer:u=>{t(e?.filter(f=>f.originalFile!==u.originalFile)),O(`${N.environment.supportPath}/${u.originalFile}`),d()},handleStartCT:(u,f=!1)=>{!D(f)||(I(u.timeInSeconds,u.name,u.selectedSound),d())},handleCreateCT:u=>{let f={name:u.name,timeInSeconds:u.secondsSet,selectedSound:"default"};L(f),d()},handleDeleteCT:u=>{v(u),d()}}}var a=require("react/jsx-runtime");function b(){let{timers:e,customTimers:t,isLoading:r,refreshTimers:o,handleStartTimer:i,handleStopTimer:l,handleStartCT:d}=k();return(0,J.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]),(0,a.jsxs)(n.MenuBarExtra,{icon:n.Icon.Clock,isLoading:r,title:e!=null&&e?.length>0?`${e[0].name}: ~${h(e[0].timeLeft)}`:void 0,children:[(0,a.jsx)(n.MenuBarExtra.Item,{title:"Click running timer to stop"}),e?.map(s=>(0,a.jsx)(n.MenuBarExtra.Item,{title:s.name+": "+h(s.timeLeft)+" left",onAction:()=>l(s)},s.originalFile)),(0,a.jsx)(n.MenuBarExtra.Separator,{}),Object.keys(t)?.sort((s,S)=>t[s].timeInSeconds-t[S].timeInSeconds).map(s=>(0,a.jsx)(n.MenuBarExtra.Item,{title:'Start "'+t[s].name+'"',onAction:()=>d(t[s],!0)},s)),(0,a.jsx)(n.MenuBarExtra.Separator,{}),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 2 Minute Timer",onAction:()=>i(60*2,"2 Minute Timer",!0)},"2M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 5 Minute Timer",onAction:()=>i(60*5,"5 Minute Timer",!0)},"5M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 10 Minute Timer",onAction:()=>i(60*10,"10 Minute Timer",!0)},"10M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 15 Minute Timer",onAction:()=>i(60*15,"15 Minute Timer",!0)},"15M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 30 Minute Timer",onAction:()=>i(60*30,"30 Minute Timer",!0)},"30M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 45 Minute Timer",onAction:()=>i(60*45,"45 Minute Timer",!0)},"45M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 60 Minute Timer",onAction:()=>i(60*60,"60 Minute Timer",!0)},"60M"),(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start 90 Minute Timer",onAction:()=>i(60*60*1.5,"90 Minute Timer",!0)},"90M"),(0,a.jsx)(n.MenuBarExtra.Section,{title:"Custom Timer",children:(0,a.jsx)(n.MenuBarExtra.Item,{title:"Start Custom Timer",onAction:async()=>await(0,n.launchCommand)({name:"startCustomTimer",type:n.LaunchType.UserInitiated})},"custom")})]})}0&&(module.exports={});

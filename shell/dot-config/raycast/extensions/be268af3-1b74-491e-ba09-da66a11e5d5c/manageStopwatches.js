"use strict";var N=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var K=(t,e)=>{for(var o in e)N(t,o,{get:e[o],enumerable:!0})},Q=(t,e,o,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Y(e))!z.call(t,n)&&n!==o&&N(t,n,{get:()=>e[n],enumerable:!(a=q(e,n))||a.enumerable});return t};var X=t=>Q(N({},"__esModule",{value:!0}),t);var ot={};K(ot,{default:()=>H});module.exports=X(ot);var s=require("@raycast/api"),j=require("react");var D=require("@raycast/api"),I=require("react");var h=t=>{let e=Math.floor(t/3600),o=String(Math.floor(t%3600/60)).padStart(2,"0"),a=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${o}:${a}`},$=t=>{let e=new Date(t),o=[e.getFullYear().toString(),e.getMonth().toString().padStart(2,"0"),e.getDate().toString().padStart(2,"0")],a=[e.getHours(),e.getMinutes(),e.getSeconds()].map(T=>T.toString().padStart(2,"0")),n=o.join("-"),f=a.join(":");return`${n} ${f}`},g=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var d=require("@raycast/api"),R=require("child_process"),F=require("crypto"),r=require("fs"),A=require("path");var m=d.environment.supportPath+"/raycast-stopwatches.json",w=()=>{(!(0,r.existsSync)(m)||(0,r.readFileSync)(m).toString()=="")&&(0,r.writeFileSync)(m,"[]")},W=(t="")=>({name:t,swID:(0,F.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),Z=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,g({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let o=Math.max(0,g({d2:e.timeStarted}));e.timeElapsed=o-e.pauseElapsed}}),t),L=()=>{w();let t=JSON.parse((0,r.readFileSync)(m).toString()),e=tt(t),o=Z(e);return o.sort((a,n)=>a.timeElapsed-n.timeElapsed),o},v=async(t="Untitled")=>{w();let e=JSON.parse((0,r.readFileSync)(m).toString()),o=W(t);e.push(o),(0,r.writeFileSync)(m,JSON.stringify(e)),(0,d.popToRoot)(),await(0,d.showHUD)(`Stopwatch "${t}" started! \u{1F389}`)},U=t=>{w();let e=JSON.parse((0,r.readFileSync)(m).toString());e=e.map(o=>o.swID==t?{...o,lastPaused:new Date}:o),(0,r.writeFileSync)(m,JSON.stringify(e))},k=t=>{w();let e=JSON.parse((0,r.readFileSync)(m).toString());e=e.map(o=>o.swID==t?{...o,pauseElapsed:o.pauseElapsed+g({d2:o.lastPaused}),lastPaused:"----"}:o),(0,r.writeFileSync)(m,JSON.stringify(e))},V=t=>{w();let e=JSON.parse((0,r.readFileSync)(m).toString());e=e.filter(o=>o.swID!==t),(0,r.writeFileSync)(m,JSON.stringify(e))},tt=t=>((0,r.readdirSync)(d.environment.supportPath).forEach(o=>{if((0,A.extname)(o)==".stopwatch"){let a=W((0,r.readFileSync)(d.environment.supportPath+"/"+o).toString()),n=o.replace(/__/g,":").replace(".stopwatch","");a.timeStarted=new Date(n),a.timeElapsed=Math.max(0,g({})),(0,R.execSync)(`rm "${d.environment.supportPath}/${o}"`),t.push(a)}}),(0,r.writeFileSync)(m,JSON.stringify(t)),t),_=(t,e)=>{w();let a=JSON.parse((0,r.readFileSync)(m,"utf8")).map(n=>n.swID==t?{...n,name:e}:n);(0,r.writeFileSync)(m,JSON.stringify(a))};function b(){let[t,e]=(0,I.useState)(void 0),[o,a]=(0,I.useState)(t===void 0),n=()=>{let c=L();e(c),a(!1)},f=(c="Untitled")=>{v(c),n()},T=c=>{U(c),n()},E=c=>{k(c),n()},P=c=>{(0,D.getPreferenceValues)().copyOnSwStop&&D.Clipboard.copy(h(c.timeElapsed)),V(c.swID),n()};return{stopwatches:t,isLoading:o,refreshSWes:n,handleRestartSW:c=>{P(c),f(c.name),n()},handleStartSW:f,handleStopSW:P,handlePauseSW:T,handleUnpauseSW:E}}var l=require("@raycast/api");var S=require("@raycast/api");var u=require("fs");var O=S.environment.supportPath+"/customTimers.json",lt=S.environment.supportPath+"/defaultPresetVisibles.json";function x(t,e){let o=S.environment.supportPath+"/"+t;(0,u.writeFileSync)(o,e)}function et(){(0,u.existsSync)(O)||(0,u.writeFileSync)(O,JSON.stringify({}))}function B(t,e){et();let o=JSON.parse((0,u.readFileSync)(O,"utf8"));o[t].name=e,(0,u.writeFileSync)(O,JSON.stringify(o))}var y=require("react/jsx-runtime");function J(t){let e=o=>{if(o===""||o===t.currentName)new l.Toast({style:l.Toast.Style.Failure,title:"No new name given!"}).show();else{switch((0,l.popToRoot)(),t.originalFile){case"customTimer":B(t.ctID?t.ctID:"-99",o);break;case"stopwatch":_(t.ctID?t.ctID:"-99",o);break;default:x(t.originalFile,o);break}new l.Toast({style:l.Toast.Style.Success,title:`Renamed to ${o}!`}).show()}};return(0,y.jsx)(l.Form,{actions:(0,y.jsx)(l.ActionPanel,{children:(0,y.jsx)(l.Action.SubmitForm,{title:"Rename",onSubmit:o=>e(o.newName)})}),children:(0,y.jsx)(l.Form.TextField,{id:"newName",title:"New name",placeholder:t.currentName})})}var i=require("react/jsx-runtime");function H(){let{stopwatches:t,isLoading:e,refreshSWes:o,handleRestartSW:a,handleStartSW:n,handleStopSW:f,handlePauseSW:T,handleUnpauseSW:E}=b(),{push:P}=(0,s.useNavigation)();(0,j.useEffect)(()=>{o(),setInterval(()=>{o()},1e3)},[]);let C={tag:{value:"Paused",color:s.Color.Red}},c={tag:{value:"Running",color:s.Color.Green}},M={source:s.Icon.Clock,tintColor:s.Color.Red},G={source:s.Icon.Clock,tintColor:s.Color.Green};return(0,i.jsx)(s.List,{isLoading:e,children:(0,i.jsxs)(s.List.Section,{title:t?.length!==0&&t!=null?"Currently Running":"No Stopwatches Running",children:[t?.map(p=>(0,i.jsx)(s.List.Item,{icon:p.lastPaused=="----"?G:M,title:p.name,subtitle:h(p.timeElapsed)+" elapsed",accessories:[{text:"Started at "+$(p.timeStarted)},p.lastPaused=="----"?c:C],actions:(0,i.jsxs)(s.ActionPanel,{children:[p.lastPaused=="----"?(0,i.jsx)(s.Action,{title:"Pause Stopwatch",onAction:()=>T(p.swID)}):(0,i.jsx)(s.Action,{title:"Unpause Stopwatch",onAction:()=>E(p.swID)}),(0,i.jsx)(s.Action,{title:"Rename Stopwatch",onAction:()=>P((0,i.jsx)(J,{currentName:p.name,originalFile:"stopwatch",ctID:p.swID}))}),(0,i.jsx)(s.Action.CopyToClipboard,{title:"Copy Current Time",shortcut:{modifiers:["cmd"],key:"c"},content:h(p.timeElapsed)}),(0,i.jsx)(s.Action,{title:"Restart Stopwatch",shortcut:{modifiers:["cmd"],key:"r"},onAction:()=>a(p)}),(0,i.jsx)(s.Action,{title:"Stop Stopwatch",shortcut:{modifiers:["ctrl"],key:"x"},onAction:()=>f(p)})]})},p.swID)),(0,i.jsx)(s.List.Item,{icon:s.Icon.Clock,title:"Create a new stopwatch",subtitle:"Press Enter to start a stopwatch",actions:(0,i.jsx)(s.ActionPanel,{children:(0,i.jsx)(s.Action,{title:"Start Stopwatch",onAction:()=>n()})})},0)]})})}

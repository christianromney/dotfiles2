"use strict";var I=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var n in e)I(t,n,{get:e[n],enumerable:!0})},H=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of b(e))!k.call(t,a)&&a!==n&&I(t,a,{get:()=>e[a],enumerable:!(r=C(e,a))||r.enumerable});return t};var j=t=>H(I({},"__esModule",{value:!0}),t);var F={};A(F,{default:()=>v});module.exports=j(F);var c=require("@raycast/api"),R=require("react");var g=require("@raycast/api"),T=require("react");var u=t=>{let e=Math.floor(t/3600),n=String(Math.floor(t%3600/60)).padStart(2,"0"),r=String(Math.floor(t%60)).padStart(2,"0");return`${e===0?"":e+":"}${n}:${r}`};var h=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var d=require("@raycast/api"),P=require("child_process"),E=require("crypto"),o=require("fs"),M=require("path");var p=d.environment.supportPath+"/raycast-stopwatches.json",f=()=>{(!(0,o.existsSync)(p)||(0,o.readFileSync)(p).toString()=="")&&(0,o.writeFileSync)(p,"[]")},W=(t="")=>({name:t,swID:(0,E.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),V=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,h({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let n=Math.max(0,h({d2:e.timeStarted}));e.timeElapsed=n-e.pauseElapsed}}),t),O=()=>{f();let t=JSON.parse((0,o.readFileSync)(p).toString()),e=_(t),n=V(e);return n.sort((r,a)=>r.timeElapsed-a.timeElapsed),n},B=async(t="Untitled")=>{f();let e=JSON.parse((0,o.readFileSync)(p).toString()),n=W(t);e.push(n),(0,o.writeFileSync)(p,JSON.stringify(e)),(0,d.popToRoot)(),await(0,d.showHUD)(`Stopwatch "${t}" started! \u{1F389}`)},N=t=>{f();let e=JSON.parse((0,o.readFileSync)(p).toString());e=e.map(n=>n.swID==t?{...n,lastPaused:new Date}:n),(0,o.writeFileSync)(p,JSON.stringify(e))},J=t=>{f();let e=JSON.parse((0,o.readFileSync)(p).toString());e=e.map(n=>n.swID==t?{...n,pauseElapsed:n.pauseElapsed+h({d2:n.lastPaused}),lastPaused:"----"}:n),(0,o.writeFileSync)(p,JSON.stringify(e))},$=t=>{f();let e=JSON.parse((0,o.readFileSync)(p).toString());e=e.filter(n=>n.swID!==t),(0,o.writeFileSync)(p,JSON.stringify(e))},_=t=>((0,o.readdirSync)(d.environment.supportPath).forEach(n=>{if((0,M.extname)(n)==".stopwatch"){let r=W((0,o.readFileSync)(d.environment.supportPath+"/"+n).toString()),a=n.replace(/__/g,":").replace(".stopwatch","");r.timeStarted=new Date(a),r.timeElapsed=Math.max(0,h({})),(0,P.execSync)(`rm "${d.environment.supportPath}/${n}"`),t.push(r)}}),(0,o.writeFileSync)(p,JSON.stringify(t)),t);function y(){let[t,e]=(0,T.useState)(void 0),[n,r]=(0,T.useState)(t===void 0),a=()=>{let i=O();e(i),r(!1)},l=(i="Untitled")=>{B(i),a()},D=i=>{N(i),a()},m=i=>{J(i),a()},w=i=>{(0,g.getPreferenceValues)().copyOnSwStop&&g.Clipboard.copy(u(i.timeElapsed)),$(i.swID),a()};return{stopwatches:t,isLoading:n,refreshSWes:a,handleRestartSW:i=>{w(i),l(i.name),a()},handleStartSW:l,handleStopSW:w,handlePauseSW:D,handleUnpauseSW:m}}var x=(t,e)=>(t==null||t.length==0||t.length==null)&&!["always","onlyWhenNotRunning"].includes(e.showMenuBarIconWhen),U=(t,e)=>{if(t===void 0||t?.length===0||t.length==null)return;let n="timeLeft"in t[0]?t[0].timeLeft:t[0].timeElapsed;return e.showTitleInMenuBar?`${t[0].name}: ~${u(n)}`:`~${u(n)}`},L=(t,e,n)=>{switch(e.showMenuBarIconWhen){case"always":return n;case"never":return;case"onlyWhenRunning":return t!==void 0&&t?.length>0?n:void 0;case"onlyWhenNotRunning":return t===void 0||t?.length===0?n:void 0}};var S=require("react/jsx-runtime");function v(){let{stopwatches:t,isLoading:e,refreshSWes:n,handlePauseSW:r,handleStartSW:a,handleStopSW:l,handleUnpauseSW:D}=y();(0,R.useEffect)(()=>{n(),setInterval(()=>{n()},1e3)},[]),e&&n();let m=(0,c.getPreferenceValues)();if(x(t,m))return null;let w=s=>s.lastPaused==="----"?" elapsed":" (paused)";return(0,S.jsxs)(c.MenuBarExtra,{icon:L(t,m,c.Icon.Stopwatch),isLoading:e,title:U(t,m),children:[(0,S.jsx)(c.MenuBarExtra.Item,{title:"Click running stopwatch to pause"}),t?.map(s=>(0,S.jsx)(c.MenuBarExtra.Item,{title:s.name+": "+u(s.timeElapsed)+w(s),onAction:()=>s.lastPaused==="----"?r(s.swID):D(s.swID)},s.swID)),(0,S.jsx)(c.MenuBarExtra.Section,{children:t?.map(s=>(0,S.jsx)(c.MenuBarExtra.Item,{title:`Delete "${s.name}"`,onAction:()=>l(s)},s.swID))}),(0,S.jsx)(c.MenuBarExtra.Section,{children:(0,S.jsx)(c.MenuBarExtra.Item,{title:"Start New Stopwatch",onAction:()=>a()},"startSW")})]})}

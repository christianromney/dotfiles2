"use strict";var D=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var L=(t,e)=>{for(var a in e)D(t,a,{get:e[a],enumerable:!0})},b=(t,e,a,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of k(e))!A.call(t,s)&&s!==a&&D(t,s,{get:()=>e[s],enumerable:!(r=v(e,s))||r.enumerable});return t};var C=t=>b(D({},"__esModule",{value:!0}),t);var j={};L(j,{default:()=>x});module.exports=C(j);var i=require("@raycast/api"),U=require("react");var w=require("@raycast/api"),E=require("react");var d=t=>{let e=Math.floor(t/3600),a=String(Math.floor(t%3600/60)).padStart(2,"0"),r=String(Math.floor(t%60)).padStart(2,"0");return`${e}:${a}:${r}`};var u=t=>(t.d1=t.d1=="----"?void 0:t.d1,t.d2=t.d2=="----"?void 0:t.d2,Math.round((t.d1?new Date(t.d1):new Date).getTime()-(t.d2?new Date(t.d2):new Date).getTime())/1e3);var c=require("@raycast/api"),P=require("child_process"),W=require("crypto"),o=require("fs"),M=require("path");var p=c.environment.supportPath+"/raycast-stopwatches.json",h=()=>{(!(0,o.existsSync)(p)||(0,o.readFileSync)(p).toString()=="")&&(0,o.writeFileSync)(p,"[]")},O=(t="")=>({name:t,swID:(0,W.randomUUID)(),timeStarted:new Date,timeElapsed:-99,lastPaused:"----",pauseElapsed:0}),H=t=>(t.map(e=>{if(e.lastPaused!="----")e.timeElapsed=Math.max(0,u({d1:e.lastPaused,d2:e.timeStarted})-e.pauseElapsed);else{let a=Math.max(0,u({d2:e.timeStarted}));e.timeElapsed=a-e.pauseElapsed}}),t),T=()=>{h();let t=JSON.parse((0,o.readFileSync)(p).toString()),e=R(t),a=H(e);return a.sort((r,s)=>r.timeElapsed-s.timeElapsed),a},J=async(t="Untitled")=>{h();let e=JSON.parse((0,o.readFileSync)(p).toString()),a=O(t);e.push(a),(0,o.writeFileSync)(p,JSON.stringify(e)),(0,c.popToRoot)(),await(0,c.showHUD)(`Stopwatch "${t}" started! \u{1F389}`)},N=t=>{h();let e=JSON.parse((0,o.readFileSync)(p).toString());e=e.map(a=>a.swID==t?{...a,lastPaused:new Date}:a),(0,o.writeFileSync)(p,JSON.stringify(e))},$=t=>{h();let e=JSON.parse((0,o.readFileSync)(p).toString());e=e.map(a=>a.swID==t?{...a,pauseElapsed:a.pauseElapsed+u({d2:a.lastPaused}),lastPaused:"----"}:a),(0,o.writeFileSync)(p,JSON.stringify(e))},B=t=>{h();let e=JSON.parse((0,o.readFileSync)(p).toString());e=e.filter(a=>a.swID!==t),(0,o.writeFileSync)(p,JSON.stringify(e))},R=t=>((0,o.readdirSync)(c.environment.supportPath).forEach(a=>{if((0,M.extname)(a)==".stopwatch"){let r=O((0,o.readFileSync)(c.environment.supportPath+"/"+a).toString()),s=a.replace(/__/g,":").replace(".stopwatch","");r.timeStarted=new Date(s),r.timeElapsed=Math.max(0,u({})),(0,P.execSync)(`rm "${c.environment.supportPath}/${a}"`),t.push(r)}}),(0,o.writeFileSync)(p,JSON.stringify(t)),t);function I(){let[t,e]=(0,E.useState)(void 0),[a,r]=(0,E.useState)(t===void 0),s=()=>{let n=T();e(n),r(!1)},l=(n="Untitled")=>{J(n),s()},g=n=>{N(n),s()},m=n=>{$(n),s()},f=n=>{(0,w.getPreferenceValues)().copyOnSwStop&&w.Clipboard.copy(d(n.timeElapsed)),B(n.swID),s()};return{stopwatches:t,isLoading:a,refreshSWes:s,handleRestartSW:n=>{f(n),l(n.name),s()},handleStartSW:l,handleStopSW:f,handlePauseSW:g,handleUnpauseSW:m}}var S=require("react/jsx-runtime");function x(){let{stopwatches:t,isLoading:e,refreshSWes:a,handlePauseSW:r,handleStartSW:s,handleStopSW:l,handleUnpauseSW:g}=I();(0,U.useEffect)(()=>{a(),setInterval(()=>{a()},1e3)},[]),e&&a();let m=(0,i.getPreferenceValues)();if((t==null||t.length==0||t.length==null)&&m.showMenuBarItemWhen!=="always")return null;let f=()=>{if(!(t===void 0||t?.length===0||t.length==null))return m.showTitleInMenuBar?`${t[0].name}: ~${d(t[0].timeElapsed)}`:`~${d(t[0].timeElapsed)}`},y=n=>n.lastPaused==="----"?" elapsed":" (paused)";return(0,S.jsxs)(i.MenuBarExtra,{icon:m.showMenuBarItemWhen!=="never"?i.Icon.Stopwatch:void 0,isLoading:e,title:f(),children:[(0,S.jsx)(i.MenuBarExtra.Item,{title:"Click running stopwatch to pause"}),t?.map(n=>(0,S.jsx)(i.MenuBarExtra.Item,{title:n.name+": "+d(n.timeElapsed)+y(n),onAction:()=>n.lastPaused==="----"?r(n.swID):g(n.swID)},n.swID)),(0,S.jsx)(i.MenuBarExtra.Section,{children:t?.map(n=>(0,S.jsx)(i.MenuBarExtra.Item,{title:`Delete "${n.name}"`,onAction:()=>l(n)},n.swID))}),(0,S.jsx)(i.MenuBarExtra.Section,{children:(0,S.jsx)(i.MenuBarExtra.Item,{title:"Start New Stopwatch",onAction:()=>s()},"startSW")})]})}
